# JSON Formatter & Validator - 任务清单

> 项目进度跟踪 | 更新时间: 2025-10-23

## 📊 总体进度

- **已完成**: 4/19 任务
- **进行中**: 0/19 任务
- **待开始**: 15/19 任务
- **完成度**: 21%

---

## ✅ 已完成任务

### ~~Task 1: Tauri Project Scaffolding~~
**功能描述**: 初始化 Tauri 应用结构,配置包元数据,确保项目在目标平台上构建并运行基本窗口。

**验收标准**:
- ✅ 运行 `npm run tauri:dev` 在 macOS 上启动空白应用窗口
- ✅ 项目元数据(名称、版本、标识符)符合产品要求
- ✅ 仓库包含必要的配置文件(Tauri 配置、包清单)且无 lint 错误

---

### ~~Task 2: JSON Parsing & Validation Service~~
**功能描述**: 实现核心逻辑以解析 JSON 输入、检测错误并返回包括错误位置的结构化验证结果。

**验收标准**:
- ✅ 有效的 JSON 输入返回成功状态和解析输出
- ✅ 无效的 JSON 返回包含行号和列号(如果可用)的错误
- ✅ 服务处理最大 5 MB 的有效负载而不阻塞 UI 线程
- ✅ 14/14 Rust 单元测试通过

**实现文件**:
- `src-tauri/src/models/validation.rs`
- `src-tauri/src/services/json_parser.rs`
- `src-tauri/src/lib.rs` (validate_json 命令)

---

### ~~Task 3: JSON Formatting & Minification Engine~~
**功能描述**: 提供美化打印 JSON(可配置缩进)和压缩 JSON(同时保留语义)的功能。

**验收标准**:
- ✅ 美化输出默认使用两个空格缩进并遵循用户配置的缩进
- ✅ 压缩选项移除多余空白并生成有效的 JSON
- ✅ 尾部换行符包含/排除与用户偏好一致
- ✅ 29/29 Rust 单元测试通过

**实现文件**:
- `src-tauri/src/models/formatting.rs`
- `src-tauri/src/services/json_formatter.rs`
- `src-tauri/src/lib.rs` (format_json, minify_json 命令)
- `src/types/formatting.ts`
- `src/services/jsonService.ts` (formatJson, minifyJson 方法)

---

### ~~Task 4: Desktop UI Layout~~
**功能描述**: 构建主窗口布局,在宽屏上并排显示输入和输出面板,在窄屏上垂直堆叠。

**验收标准**:
- ✅ 布局响应窗口调整大小,在水平和垂直排列之间切换
- ✅ 面板通过可滚动区域容纳大型有效负载
- ✅ 验证状态指示器和操作按钮无需滚动即可保持可见
- ✅ 深色/浅色主题自动适配系统设置

**实现文件**:
- `src/App.tsx` (完全重构)
- `src/components/Toolbar.tsx`
- `src/components/JsonPanel.tsx`
- `src/styles.css` (完全重构,响应式设计)

---

## 🔄 进行中任务

_当前无进行中任务_

---

## 📋 待开始任务

### Task 5: Validation Workflow Controls
**功能描述**: 实现用户控件以手动触发验证,可选择在输入更改时自动验证,并提供清晰的成功或失败反馈。

**验收标准**:
- [ ] 验证按钮运行验证并更新状态指示器
- [ ] 自动验证切换保持用户选择,并在启用时重新验证输入编辑
- [ ] 成功状态显示确认文本/图标;失败状态显示错误摘要

**预计工作量**: 中等

---

### Task 6: Error Highlighting & Messaging
**功能描述**: 显示详细的错误反馈,包括突出显示无效的 JSON 片段,并在问题解决之前保留先前的有效输出。

**验收标准**:
- [ ] 错误消息包含行/列信息(如果可用)
- [ ] 输入视图突出显示与错误关联的区域
- [ ] 在错误期间,先前的格式化输出保持可见但标记为过时

**预计工作量**: 中等

---

### Task 7: Formatting Actions & Preferences
**功能描述**: 公开用于格式化、压缩、缩进选择和尾部换行符偏好的 UI 控件,跨会话持久化设置。

**验收标准**:
- [ ] 格式化和压缩按钮对当前输入一致操作
- [ ] 缩进选择(2 或 4 个空格)和尾部换行符切换被存储并在应用重启时恢复
- [ ] 偏好通过 Tauri 设置或等效本地存储持久化

**预计工作量**: 中等

---

### Task 8: Clipboard Utilities
**功能描述**: 为原始输入和格式化输出提供复制操作,确保与系统剪贴板的可靠交互。

**验收标准**:
- [ ] 复制按钮将正确内容传输到剪贴板并提供用户反馈
- [ ] 操作尊重所有支持的操作系统的剪贴板权限
- [ ] 复制操作可通过键盘快捷键使用

**预计工作量**: 小

---

### Task 9: File Import & Export
**功能描述**: 允许用户将 JSON 文件导入输入窗格并将格式化的 JSON 导出到磁盘。

**验收标准**:
- [ ] 导入对话框支持选择本地 JSON 文件并填充输入区域
- [ ] 导出对话框将当前格式化的输出保存为 `.json`,处理覆盖确认
- [ ] 错误(权限、格式错误的文件)以清晰的消息显示

**预计工作量**: 中等

---

### Task 10: Clear & Empty State Handling
**功能描述**: 实现控件以在用户确认后清除输入/输出,并在没有 JSON 时提供指导。

**验收标准**:
- [ ] 清除操作在丢弃未保存的格式化输出之前提示
- [ ] 清除后,空状态消息引导用户粘贴或导入 JSON
- [ ] 清除操作重置验证状态和过时标记

**预计工作量**: 小

---

### Task 11: Keyboard Shortcuts
**功能描述**: 将键盘快捷键映射到主要操作(验证、格式化、压缩、复制输入/输出、清除、导入、导出)并确保可访问性。

**验收标准**:
- [ ] 快捷键列表在应用内记录(工具提示或帮助视图)
- [ ] 即使按钮未聚焦,快捷键也会触发相应的操作
- [ ] 快捷键遵循操作系统约定,不与默认系统绑定冲突

**预计工作量**: 中等

---

### Task 12: Theme & Appearance Settings
**功能描述**: 提供浅色/深色主题,默认遵循系统偏好,并允许手动切换。

**验收标准**:
- [ ] 应用在启动时检测操作系统主题并应用匹配主题
- [ ] 手动切换覆盖系统主题并持久化偏好
- [ ] 对比度符合文本和控件的可访问性指南

**预计工作量**: 小 (部分已完成:自动主题切换已实现)

---

### Task 13: Payload Metrics & Status Indicators
**功能描述**: 显示当前输入的字符和行数,并在 UI 中显示验证状态。

**验收标准**:
- [ ] 指标在用户编辑 JSON 时实时更新
- [ ] 验证状态清楚地指示成功、待处理或错误状态
- [ ] 无论滚动位置如何,指示器都保持可见

**预计工作量**: 小 (部分已完成:行数和字符数统计已实现)

---

### Task 14: Performance & Responsiveness
**功能描述**: 优化应用以快速加载、处理大型有效负载,并在验证或格式化期间保持响应。

**验收标准**:
- [ ] 在中档笔记本电脑上,从冷启动到交互式 UI 在两秒内完成
- [ ] 编辑或验证 5 MB JSON 不会冻结 UI 超过 200 毫秒
- [ ] 长时间运行的操作通过 Tauri 命令在主 UI 线程之外执行

**预计工作量**: 中等

---

### Task 15: Preference Storage & Sync
**功能描述**: 集中存储用户偏好(主题、自动验证、缩进、尾部换行符)并确保启动时检索。

**验收标准**:
- [ ] 偏好在所有支持的平台上跨重启持久化
- [ ] 损坏或缺失的偏好存储回退到安全默认值而不会崩溃
- [ ] 设置在更改后立即更新,无需重启应用

**预计工作量**: 中等

---

### Task 16: Logging & Issue Reporting
**功能描述**: 实现验证操作的可选本地日志记录,并提供手动问题报告快捷方式。

**验收标准**:
- [ ] 日志存储捕获带有时间戳的验证成功/失败
- [ ] 用户可以从应用内打开日志位置或清除日志
- [ ] "报告问题"操作打开项目的问题跟踪器或预填充的电子邮件草稿

**预计工作量**: 中等

---

### Task 17: Packaging & Distribution
**功能描述**: 为 macOS(以及未来的 Windows/Linux)配置 Tauri 打包,包括签名步骤和安装程序生成。

**验收标准**:
- [ ] `tauri build` 生成准备分发的签名 macOS 工件
- [ ] 构建管道记录 Windows/Linux 的步骤(即使尚未生成)
- [ ] 发布工件包括版本化元数据和校验和生成

**预计工作量**: 大

---

### Task 18: Test Automation & QA
**功能描述**: 为解析/格式化逻辑建立自动化单元测试、端到端冒烟测试和手动 QA 检查表。

**验收标准**:
- [ ] 单元测试涵盖验证和格式化实用程序的成功/失败路径
- [ ] 端到端测试在 macOS CI 上验证粘贴 → 验证 → 格式化 → 复制
- [ ] 手动 QA 检查表包括键盘快捷键、主题切换、导入/导出和大型有效负载场景

**预计工作量**: 大 (部分已完成:Rust 单元测试已完成)

---

### Task 19: Risk Mitigation & Open Decisions
**功能描述**: 解决有关示例数据捆绑、更新分发、安装程序要求和路线图功能的未决问题。

**验收标准**:
- [ ] 决策日志记录每个已识别风险/未决问题的结果
- [ ] 路线图概述架构验证或 JSON-with-comments 支持是否被推迟或安排
- [ ] 分发策略指定更新节奏和安装程序格式

**预计工作量**: 小

---

## 📈 里程碑

### Milestone 1: 核心功能 (已完成 ✅)
- ✅ Task 1: 项目脚手架
- ✅ Task 2: JSON 验证服务
- ✅ Task 3: JSON 格式化引擎
- ✅ Task 4: 桌面 UI 布局

### Milestone 2: 用户体验增强 (0/6)
- ⏳ Task 5: 验证工作流控制
- ⏳ Task 6: 错误高亮与消息
- ⏳ Task 7: 格式化操作与偏好
- ⏳ Task 8: 剪贴板工具
- ⏳ Task 9: 文件导入导出
- ⏳ Task 10: 清除与空状态处理

### Milestone 3: 高级功能 (0/4)
- ⏳ Task 11: 键盘快捷键
- ⏳ Task 12: 主题与外观设置
- ⏳ Task 13: 负载指标与状态
- ⏳ Task 14: 性能与响应性

### Milestone 4: 生产就绪 (0/5)
- ⏳ Task 15: 偏好存储与同步
- ⏳ Task 16: 日志与问题报告
- ⏳ Task 17: 打包与分发
- ⏳ Task 18: 测试自动化与 QA
- ⏳ Task 19: 风险缓解与开放决策

---

## 🔧 技术栈

**后端 (Rust)**
- Tauri 2.9
- serde_json (JSON 解析)
- tokio (异步运行时)

**前端 (TypeScript + React)**
- React 18.3
- TypeScript 5.2
- Vite 5.2

**工具**
- ESLint + Prettier (代码质量)
- Cargo test (Rust 测试)

---

## 📝 备注

1. **当前聚焦**: 核心功能已完成,下一步应专注于 Milestone 2 的用户体验增强
2. **技术债务**: 无
3. **已知问题**: 无
4. **性能基线**:
   - Rust 测试: 29/29 通过
   - 应用启动时间: ~6 秒 (开发模式)
   - 支持最大 JSON 大小: 5 MB

---

**上次更新**: 2025-10-23
**维护者**: Development Team
**项目版本**: 0.1.0
